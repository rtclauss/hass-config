################################################################
## Packages / Media Players
################################################################

################################################
## Customize
################################################

homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: "media_player"

      expose: &expose
        <<: *customize
        haaska_hidden: false
        homebridge_hidden: false

    ################################################
    ## Alarm Panels
    ################################################

    ################################################
    ## Automations
    ################################################

    ################################################
    ## Binary Sensors
    ################################################

    ################################################
    ## Cameras
    ################################################

    ################################################
    ## Device Trackers
    ################################################

    ################################################
    ## Frontend
    ################################################

    ################################################
    ## Groups
    ################################################

    ################################################
    ## Input Boolean
    ################################################

    ################################################
    ## Input Numbers
    ################################################

    ################################################
    ## Input Select
    ################################################

    ################################################
    ## iOS
    ################################################

    ################################################
    ## Light
    ################################################

    ################################################
    ## Media Player
    ################################################

    ################################################
    ## Plant
    ################################################

    ################################################
    ## Proximity
    ################################################

    ################################################
    ## Scripts
    ################################################

    ################################################
    ## Sensors
    ################################################

    ################################################
    ## Thermostats
    ################################################

    ################################################
    ## Zone
    ################################################

########################
# Alarm Panel
########################
alarm_control_panel:

########################
## Automation
########################
automation:
  - id: bedroom_music_volume
    alias: bedroom_music_volume
    trigger:
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "rotate_left"
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "rotate_right"
      - platform: state
        entity_id: sensor.owner_suite_cube_action_angle
        not_to: None
    action:
      - service: media_player.volume_set
        data:
          entity_id: media_player.bedroom
          # volume_level: >-
          # {{ (state_attr('media_player.bedroom', 'volume_level') + trigger.event.data.args.relative_degrees/1000) | round(2) | float(default=0) }}
          volume_level: >-
            {{ (state_attr('media_player.bedroom', 'volume_level') + (float(trigger.to_state.state)/1000)) | round(2) | float(default=0) }}

  - id: bedroom_music_play_pause
    alias: bedroom_music_play_pause
    trigger:
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "knock"
      - platform: state
        entity_id: sensor.owner_suite_cube_action
        to: "tap"
    action:
      - service: media_player.media_play_pause
        data:
          entity_id: media_player.bedroom

  - id: bed_without_prep
    alias: bed_without_prep
    trigger:
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "knock"
      - platform: state
        entity_id: binary_sensor.master_bed_occupancy
        to: "on"
    condition:
      - and:
          - condition: numeric_state
            entity_id: media_player.bedroom
            attribute: "volume_level"
            above: 0.1
          - condition: state
            entity_id:
              - media_player.bedroom
            state: "playing"
    action:
      - service: script.turn_on
        data:
          entity_id: script.spotify_bedtime_volume

  - id: bedroom_music_select_playlist
    alias: bedroom_music_select_playlist
    trigger:
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "flip"
      - platform: state
        entity_id: sensor.owner_suite_cube_action_to_side
        not_to:
          - "None"
          - "unknown"
          - "unavailable"
        not_from:
          - "unknown"
    action:
      - service: notify.all
        data_template:
          message: >-
            {{ "script.bedroom_playlist_" + (trigger.to_state.state | string) }}
      - service: script.turn_on
        data_template:
          entity_id: >-
            {{ "script.bedroom_playlist_" + (trigger.to_state.state | string) }}

  - id: bedroom_music_skip_track
    alias: bedroom_music_skip_track
    trigger:
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "slide"
      - platform: state
        entity_id: sensor.owner_suite_cube_action
        to: "slide"
    action:
      - service: media_player.media_next_track
        data:
          entity_id: media_player.bedroom

  - id: bedroom_music_shuffle
    alias: bedroom_music_shuffle
    trigger:
      # - platform: event
      #   event_type: zha_event
      #   event_data:
      #     device_ieee: "00:15:8d:00:02:8f:66:12"
      #     command: "shake"
      - platform: state
        entity_id: sensor.owner_suite_cube_action
        to: "shake"
    action:
      - service: media_player.shuffle_set
        data:
          entity_id: media_player.bedroom
          shuffle: >-
            {{ not (state_attr('media_player.bedroom', 'shuffle')) }}

  - id: play_music_in_bathroom
    alias: play_music_in_bathroom
    trigger:
      - platform: event
        event_type: tag_scanned
        event_data:
          device_id: FA07CA5F-46D6-45E8-BFFA-F021058CCA7A
          tag_id: 78025adc-36ac-4150-9514-9e68767ef13e
    action:
      - service: media_player.select_source
        data:
          entity_id: media_player.spotify
          source: Bathroom

  - id: play_music_in_bathroom_when_up
    alias: play_music_in_bathroom_when_up
    mode: single
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.owner_suite_bathroom_room_occupancy
    condition:
      - alias: "Not in Bed"
        condition: state
        entity_id: binary_sensor.master_bed_occupancy
        state: "off"
      - alias: "morning routine already started"
        condition: state
        entity_id: input_boolean.morning_routine
        state: "off"
      - or:
          - alias: "weekday morning time"
            condition: time
            after: "05:00:00"
            before: "10:30:00"
            weekday:
              - "mon"
              - "tue"
              - "wed"
              - "thu"
              - "fri"
          - alias: "weekend morning time"
            condition: time
            after: "07:00:00"
            before: "14:00:00"
            weekday:
              - "sat"
              - "sun"
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.morning_routine
      - alias: "Stop Playback"
        service: media_player.media_stop
        target:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
      - alias: "Set Volume 0.01"
        service: media_player.volume_set
        data:
          volume_level: 0.01
        target:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
      - service: script.turn_on
        entity_id: script.spotify_wake_up
      - alias: "Set Volume 0.09 in office"
        service: media_player.volume_set
        data:
          volume_level: 0.2
        target:
          entity_id:
            - media_player.office
      - alias: "Repeat until desired volume reached"
        repeat:
          sequence:
            - alias: "Increase Volume by 0.01"
              service: media_player.volume_set
              data:
                volume_level: "{{ 0.01 * repeat.index }}"
              target:
                entity_id:
                  - media_player.bedroom
                  - media_player.bathroom
            - delay:
                # As time passes, the delay gets smaller and smaller. 120s, 60s, 40s, 30s, 24s,..., 4s
                seconds: "{{ (1/(tan(repeat.index/120, 5))) | round(0, 'ceil', 5)}}"
          until: "{{repeat.index == 30}}"

  - id: tv_off
    alias: tv_off
    trigger:
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        from: "on"
        to: "off"
        for: "00:00:05"
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        from: "on"
        to: "unavailable"
        for: "00:00:10"
    action:
      - service: switch.turn_off
        entity_id: switch.4k_hdmi
      - service: scene.turn_on
        target:
          entity_id: scene.scene_reset_basement
        data:
          transition: 1.5

  - id: tv_on
    alias: tv_on
    trigger:
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        to: "on"
    condition:
      condition: and
      conditions:
        ## Prevent false positives in the middle of the night
        - condition: state
          entity_id: binary_sensor.master_bed_occupancy
          state: "off"
          # enabled: false
    action:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi

  - id: tv_off_at_night_bed_prep
    alias: tv_off_at_night_bed_prep
    trigger:
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        #TODO Temporary hack: ADB showing wrong values
        from: "on"
        to: "off"
        for: "00:00:20"
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        # With power save mode off tv is off all the way.
        from: "on"
        to: "unavailable"
        for: "00:00:20"
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: "00:15:8d:00:02:12:fc:ff"
          command: "attribute_updated"
      - platform: state
        entity_id:
          - sensor.hall_button_action
        to: "single"
    condition:
      condition: and
      conditions:
        - condition: time
          after: "20:00:00"
          before: "04:00:00"
        - condition: state
          entity_id: input_boolean.guest_mode
          state: "off"
        - condition: state
          entity_id: binary_sensor.master_bed_occupancy
          state: "off"
          # enabled: false
    action:
      - service: cover.close_cover
        entity_id:
          - cover.garage_door
      - service: media_player.turn_off
        data:
          entity_id: media_player.lg_webos_smart_tv
      - service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
          volume_level: 0.02
      - service: scene.turn_on
        target:
          entity_id: scene.bedroom_prep
        data:
          transition: 60
      - service: script.turn_on
        entity_id: script.spotify_bedtime

  - id: tv_paused
    alias: tv_paused
    initial_state: true
    trigger:
      - platform: state
        entity_id: media_player.basement
        from: "playing"
        to: "paused"
        for: "00:00:05"
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        #TODO Temporary hack: ADB showing wrong values
        from: "playing"
        to: "paused"
        for: "00:00:02"
    condition:
      condition: and
      conditions:
        - condition: time
          after: "19:30:00"
          before: "23:59:00"
        - condition: state
          entity_id: input_boolean.guest_mode
          state: "off"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.tv_paused
        data:
          transition: 5

  - id: tv_resumed
    alias: tv_resumed
    initial_state: true
    trigger:
      - platform: state
        entity_id: media_player.lg_webos_smart_tv
        to: "playing"
        for: "00:00:20"
      - platform: state
        entity_id: media_player.basement
        from: "paused"
        to: "playing"
        for: "00:00:20"
    condition:
      condition: and
      conditions:
        - condition: time
          after: "19:30:00"
          before: "23:59:00"
        - condition: state
          entity_id: input_boolean.guest_mode
          state: "off"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.tv_resumed
        data:
          transition: 20

########################
# Binary Sensors
########################
binary_sensor:

########################
# Cameras
########################
camera:

########################
# Device Trackers
########################
device_tracker:

########################
# Frontend
########################
frontend:

########################
# Groups
########################
group:

########################
# Input Booleans
########################
input_boolean:

########################
# Input Numbers
########################
input_number:

########################
# Input Select
########################
input_select:

########################
# iOS
########################
ios:

########################
# Light
########################
light:

########################
# Media Player
########################
media_player:
  # - platform: plex
  #   entity_namespace: 'plex'

  # Configured via the UI
  # - platform: androidtv
  #   name: Living Room FireTV
  #   host: !secret living_room_firetv_ip
  #   adb_server_ip: !secret adb_server_ip
  #   adb_server_port: 5037
  #   #adbkey: "/config/androidtv/adbkey"
  #   apps:
  #     com.amazon.tv.launcher: "Fire TV"

  # - platform: spotify
  #   client_id: !secret spotify_client_id
  #   client_secret: !secret spotify_client_secret

########################
# Plant
########################
plant:

########################
# Plex
########################
# Switch to integration
#plex:
#  token: !secret plex_token
#  host: fermentor.lan

########################
# Proximity
########################
proximity:

########################
# Scenes
########################
scene:
  - name: tv_paused
    entities:
      light.basement_all_down_lights:
        state: "on"
        brightness: 128
      light.kitchen_sink:
        state: "on"
        brightness: 255
      light.den_floods:
        state: "on"
        brightness: 255

  - name: tv_resumed
    entities:
      light.basement_all_down_lights:
        state: "off"
      light.kitchen_all:
        state: "off"
      light.hall_lights_all:
        state: "off"
      light.den_all:
        state: "off"
      light.office_all:
        state: "off"
      light.office_floor_lamp_1:
        state: "off"
      light.office_floor_lamp_2:
        state: "off"
      light.deck_string:
        state: "off"

########################
# Scripts
########################
script:
  bedroom_playlist_0:
    alias: "Play LoFi"
    variables:
      playlist: >-
        {# 
        ##  Lowfi Sleep: spotify:playlist:6VHsDUVy0Hj79qMvOohTKV
        ##  Simpsons Wave: spotify:playlist:6SGXcOlYBwvOdWBwnKnZdg
        ##  SIMPSONSWAVE: spotify:playlist:0OZV1MvJmJdeShboKpNKC8
        ##  Chill Lofi Study Beats: spotify:playlist:37i9dQZF1DX8Uebhn9wzrS
        ##  Spotify Lo-Fi Beats: spotify:playlist:37i9dQZF1DWWQRwui0ExPn
        ##  Deep Sleep: spotify:playlist:37i9dQZF1DWYcDQ1hSjOpY
        #}
        {%- set plists = ["spotify:playlist:6VHsDUVy0Hj79qMvOohTKV",
          "spotify:playlist:6SGXcOlYBwvOdWBwnKnZdg",
          "spotify:playlist:0OZV1MvJmJdeShboKpNKC8",
          "spotify:playlist:37i9dQZF1DX8Uebhn9wzrS",
          "spotify:playlist:37i9dQZF1DWWQRwui0ExPn",
          "spotify:playlist:37i9dQZF1DWYcDQ1hSjOpY"
            ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Lowfi
          message: "Playing Lowfi playlist: {{ playlist }}"
      - alias: "Play random wakeup music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  bedroom_playlist_1:
    alias: "Play Guster"
    variables:
      playlist: >-
        {# 
        ## Showbox Seattle 2/16/19: spotify:playlist:65fTj3YJl4jvFmXxru7BfO
        ## MN Zoo 7/22/19: spotify:playlist:3dj3AYHFe2RKKjdQsaOWYl
        ## First Ave 2/9/19: spotify:playlist:4jmwGUvZ8XI9DmWa3NthVq
        ## w/Oregon Orchestra: spotify:playlist:6al92r67tCsIrZygrIr6d6
        ## Almost every song, ever: spotify:playlist:4z7avZTuCTdFD2uGfG6GvL
        ## Guster Radio: spotify:playlist:37i9dQZF1E4AQ4IdimJyYD
        ## Guster Accoustic: spotify:playlist:6FOsJt1HpOSkFpMgMgfVzL
        ## OMAGAH: spotify:album:33dmmZ0Zg1yvFor6pCuYGm
        ## Lost and Gone Forever: Live: spotify:album:5DDNife8S8H4uSYRFkYUNw
        ## With Utah Orchestra 7/29/22: spotify:playlist:2pkBoRddjDNLJgElp0rl45
        ## Utepils 7/8/22: spotify:playlist:4gmNQHup10wDckuwWL3IFZ
        #}
        {%- set plists = ["spotify:playlist:65fTj3YJl4jvFmXxru7BfO",
        "spotify:playlist:3dj3AYHFe2RKKjdQsaOWYl",
        "spotify:playlist:4jmwGUvZ8XI9DmWa3NthVq",
        "spotify:playlist:6al92r67tCsIrZygrIr6d6",
        "spotify:playlist:4z7avZTuCTdFD2uGfG6GvL",
        "spotify:playlist:37i9dQZF1E4AQ4IdimJyYD",
        "spotify:playlist:6FOsJt1HpOSkFpMgMgfVzL",
        "spotify:album:33dmmZ0Zg1yvFor6pCuYGm",
        "spotify:album:5DDNife8S8H4uSYRFkYUNw",
        "spotify:playlist:2pkBoRddjDNLJgElp0rl45",
        "spotify:playlist:4gmNQHup10wDckuwWL3IFZ"
        ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Guster
          message: "Playing Guster playlist: {{ playlist }}"
      - alias: "Play random wakeup music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  bedroom_playlist_2:
    alias: "Play Joe Pera"
    variables:
      playlist: >-
        {# 
        ## Sweater Weather Instrumentals: spotify:playlist:37i9dQZF1DWUvZBXGjNCU4
        ## Joe Pera Talks You to Sleep: spotify:playlist:1yaIzyYf3wtCbWTzKTR4pZ
        ## Joe Pera Listens to all of Joe Pera: spotify:playlist:6z6y5fEt0QIUuC64w1VOw4
        ## Holland Patent Public Radio: spotify:playlist:7gU7Ul8SuSReUTGYJMv9jr
        #}
        {%- set plists = ["spotify:playlist:37i9dQZF1DWUvZBXGjNCU4",
          "spotify:playlist:1yaIzyYf3wtCbWTzKTR4pZ",
          "spotify:playlist:6z6y5fEt0QIUuC64w1VOw4",
          "spotify:playlist:7gU7Ul8SuSReUTGYJMv9jr"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Joe Pera
          message: "Playing Joe Pera playlist: {{ playlist }}"
      - alias: "Play random wakeup music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  bedroom_playlist_3:
    alias: "Play VaporWave and Retro"
    variables:
      playlist: >-
        {# 
        ##  Vaporwave Aesthetic Mix: spotify:playlist:0LbHaoYiD4HCZrrHsf5JK5
        ##  RetroWave/Outrun: spotify:playlist:37i9dQZF1DXdLEN7aqioXM
        ##  REtrowave/Synthwave: spotify:playlist:3ebHKSjHujS4Tyt2KKP97R
        ##  Synthwave from Space: spotify:playlist:4sgUux9hmykyWYmVoe4W6p
        #}
        {%- set plists = ["spotify:playlist:0LbHaoYiD4HCZrrHsf5JK5",
          "spotify:playlist:37i9dQZF1DXdLEN7aqioXM",
          "spotify:playlist:3ebHKSjHujS4Tyt2KKP97R",
          "spotify:playlist:4sgUux9hmykyWYmVoe4W6p"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Retrowave
          message: "Playing RetroWave playlist: {{ playlist }}"
      - alias: "Play VaporWave music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  bedroom_playlist_4:
    alias: "Play Alt/Independent"
    variables:
      playlist: >-
        {# 
        ##  This is The Wombats: spotify:playlist:37i9dQZF1DWVK4jhlkcOzu
        ##  This is Passion Pit: spotify:playlist:37i9dQZF1DZ06evO4iu5hu
        ##  Arctic Monkeys - AM : spotify:album:78bpIziExqiI9qztvNFlQu 
        ##  This is The Mountain Goats : spotify:playlist:37i9dQZF1DWTmUQ5ZV8Wa1
        ##  This is The Griswolds : spotify:playlist:37i9dQZF1DZ06evO1XPrLQ
        ##  This is Band of Horses : spotify:user:spotify:playlist:37i9dQZF1DZ06evO0pK2Aw
        ##  Henry Jamison Radio : spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY
        ## Alternative Nation: spotify:user:topsify:playlist:1uBI8icgYcUED3T1W1X6dB
        ## Matt & Kim Daylight Playlist: spotify:user:127725734:playlist:1tpH6e8WmMkWZNKv9HFvGK
        ## MGMT Kids Playlist: spotify:user:gorillagoat:playlist:7aX5kvEDdre0kHNCvQ9sbr
        ## This is Walk the Moon: spotify:playlist:37i9dQZF1DZ06evO3VghcA
        #}
        {%- set plists = ["spotify:playlist:37i9dQZF1DWVK4jhlkcOzu",
          "spotify:playlist:37i9dQZF1DZ06evO4iu5hu",
          "spotify:album:78bpIziExqiI9qztvNFlQu",
          "spotify:playlist:37i9dQZF1DWTmUQ5ZV8Wa1",
          "spotify:playlist:37i9dQZF1DZ06evO1XPrLQ",
          "spotify:user:spotify:playlist:37i9dQZF1DZ06evO0pK2Aw",
          "spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY",
          "spotify:user:topsify:playlist:1uBI8icgYcUED3T1W1X6dB",
          "spotify:user:127725734:playlist:1tpH6e8WmMkWZNKv9HFvGK",
          "spotify:user:gorillagoat:playlist:7aX5kvEDdre0kHNCvQ9sbr",
          "spotify:playlist:37i9dQZF1DZ06evO3VghcA"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Alt/Independent
          message: "Playing Alt/Independent playlist: {{ playlist }}"
      - alias: "Play Lowfi music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  bedroom_playlist_5:
    alias: "Play LoFi"
    variables:
      playlist: >-
        {# 
        ##  Lowfi Sleep: spotify:playlist:6VHsDUVy0Hj79qMvOohTKV
        ##  Simpsons Wave: spotify:playlist:6SGXcOlYBwvOdWBwnKnZdg
        ##  SIMPSONSWAVE: spotify:playlist:0OZV1MvJmJdeShboKpNKC8
        ##  Chill Lofi Study Beats: spotify:playlist:37i9dQZF1DX8Uebhn9wzrS
        ##  Spotify Lo-Fi Beats: spotify:playlist:37i9dQZF1DWWQRwui0ExPn
        #}
        {%- set plists = ["spotify:playlist:6VHsDUVy0Hj79qMvOohTKV",
          "spotify:playlist:6SGXcOlYBwvOdWBwnKnZdg",
          "spotify:playlist:0OZV1MvJmJdeShboKpNKC8",
          "spotify:playlist:37i9dQZF1DX8Uebhn9wzrS",
          "spotify:playlist:37i9dQZF1DWWQRwui0ExPn"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Lowfi
          message: "Playing Lowfi playlist: {{ playlist }}"
      - alias: "Play Lowfi music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  spotify_arrival:
    alias: "Spotify Arrive Home"
    variables:
      playlist: >-
        {# 
        ## Arctic Monkeys - AM : spotify:album:78bpIziExqiI9qztvNFlQu 
        ## All Out 90s : spotify:user:spotify:playlist:37i9dQZF1DXbTxeAdrVG2l
        ## 2000s Smash Hits : spotify:user:myplay.com:playlist:2f6tXtN0XesjONxicAzMIw
        ## 2019 Sealand Invitiational : spotify:user:126202651:playlist:6uNCXLheVaTbfE1HRCIsQ5
        ## Discover Weekly: spotify:playlist:37i9dQZEVXcMDffrPenJPl
        ## 90s Acoustic: spotify:user:spotify:playlist:37i9dQZF1DXb9LIXaj5WhL
        ## This is Passion Pit: spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu
        ## Panic! at the Disco Pretty. Odd. : spotify:album:7Hk9WbjPbN1n2GXaK7aldw
        ## This is The Mountain Goats : spotify:playlist:37i9dQZF1DWTmUQ5ZV8Wa1
        ## It's ALT Good! : spotify:user:spotify:playlist:37i9dQZF1DX2SK4ytI2KAZ
        ## This is The Griswolds : spotify:playlist:37i9dQZF1DZ06evO1XPrLQ
        ## The Wombats : spotify:artist:0Ya43ZKWHTKkAbkoJJkwIB
        ## The Decemberists @ Palace 2018 : spotify:user:126202651:playlist:4CIBhwpAL598munofpCu6i
        ## This is Jimmy Eat World : spotify:user:spotify:playlist:37i9dQZF1DX4wNVWmoZ4FM
        ## David Bowie Legacy : spotify:album:4JEgSaokMH5mMRClx9wp3S
        ## This is Cake: spotify:user:spotify:playlist:37i9dQZF1DZ06evO3T3SWA
        ## SDSU : spotify:user:126202651:playlist:56WlVUutx91MElxdsbtzj1
        ## Your Top Songs 2018 : spotify:user:spotify:playlist:37i9dQZF1Ejutsu6U8IhOf
        ## Your Top Songs 2017 : spotify:user:spotify:playlist:37i9dQZF1E9G2yMdYA64HW
        ## Your Time Capsule : spotify:user:spotify:playlist:37i9dQZF1E4YuevTvB5WHT
        ## This is The Lumineers : spotify:user:spotify:playlist:37i9dQZF1DXdxZQJxjFMLO
        ## Guster @ Showbox Seattle 2/16/2019 spotify:user:126202651:playlist:65fTj3YJl4jvFmXxru7BfO
        ## Guster @ First Ave MSP 2/9/2019 spotify:user:126202651:playlist:4jmwGUvZ8XI9DmWa3NthVq
        ## Coheed & Cambria @ The Armory MSP 7/26/2018 spotify:user:126202651:playlist:5wO8RqOaWT9PDJNMnktftP
        ## Jimmy Eat World @ First Ave Minneapolis 5/9/18 spotify:user:126202651:playlist:3D3gu4wURrZfR813RTh5M8
        ## This is Passion Pit : spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu
        ## Your Discovery Weekly : spotify:playlist:37i9dQZEVXcMDffrPenJPl
        ## Alternative 00s : spotify:user:spotify:playlist:37i9dQZF1DX0YKekzl0blG
        ## Panic at the Disco Radio : spotify:user:spotify:playlist:37i9dQZF1E4lDVOWeZX2IT
        ## Decembersits Radio : spotify:user:spotify:playlist:37i9dQZF1E4pBKIU2s8AX1
        ## Guster Radio : spotify:user:spotify:playlist:37i9dQZF1E4AQ4IdimJyYD
        ## Jimmy Eat World Radio : spotify:user:spotify:playlist:37i9dQZF1E4tDgdv9Es4ng
        ## The Lumineers Radio : spotify:user:spotify:playlist:37i9dQZF1E4Cpj7tK5yC6M
        ## Band of Hourses Radio : spotify:user:spotify:playlist:37i9dQZF1E4tcQYL2Wtnge
        ## This is Band of Horses : spotify:user:spotify:playlist:37i9dQZF1DZ06evO0pK2Aw
        ## Henry Jamison Radio : spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY
        ## Happier Radio : spotify:playlist:37i9dQZF1E8DMpUzqgcOJh
        ## Guster @ Weesner Family Ampitheater (MN Zoo), Jul 22, 2019
        ## This is Tool : spotify:playlist:37i9dQZF1DX0GDEVNHvE3h
        ## Best of the Decade 2011-2019: spotify:playlist:37i9dQZF1DXaMu9xyX1HzK
        ## Top Songs of 2019: spotify:playlist:37i9dQZF1EtiMc33WI4nNn
        ## Daily Mix 1: spotify:playlist:37i9dQZF1E37INBdbw9l8Q
        ## Daily Mix 2: spotify:playlist:37i9dQZF1E38mQjeIPb1EL
        ## Daily Mix 3: spotify:playlist:37i9dQZF1E354DBk6AJ16Y
        ## Daily Mix 4: spotify:playlist:37i9dQZF1E38XO0gwAEnvS
        ## Daily Mix 5: spotify:playlist:37i9dQZF1E37RF0IYL80qo
        ## Daily Mix 6: spotify:playlist:37i9dQZF1E38hC1b4cOQvA
        ## Summer Rewind: spotify:playlist:37i9dQZF1CAqqQ5eUaE9tb
        ## Guster w/Utah Orchestra (7/29/22): spotify:playlist:4gmNQHup10wDckuwWL3IFZ
        #}
        {%- set plists = ["spotify:album:78bpIziExqiI9qztvNFlQu", 
          "spotify:user:spotify:playlist:37i9dQZF1DXbTxeAdrVG2l",
          "spotify:user:myplay.com:playlist:2f6tXtN0XesjONxicAzMIw",
          "spotify:user:126202651:playlist:6uNCXLheVaTbfE1HRCIsQ5",
          "spotify:playlist:37i9dQZEVXcMDffrPenJPl",
          "spotify:user:spotify:playlist:37i9dQZF1DXb9LIXaj5WhL",
          "spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu",
          "spotify:album:7Hk9WbjPbN1n2GXaK7aldw",
          "spotify:playlist:37i9dQZF1DWTmUQ5ZV8Wa1",
          "spotify:user:spotify:playlist:37i9dQZF1DX2SK4ytI2KAZ",
          "spotify:playlist:37i9dQZF1DZ06evO1XPrLQ",
          "spotify:artist:0Ya43ZKWHTKkAbkoJJkwIB",
          "spotify:user:126202651:playlist:4CIBhwpAL598munofpCu6i",
          "spotify:user:spotify:playlist:37i9dQZF1DX4wNVWmoZ4FM",
          "spotify:album:4JEgSaokMH5mMRClx9wp3S",
          "spotify:user:126202651:playlist:56WlVUutx91MElxdsbtzj1",
          "spotify:user:spotify:playlist:37i9dQZF1Ejutsu6U8IhOf",
          "spotify:user:spotify:playlist:37i9dQZF1E9G2yMdYA64HW",
          "spotify:user:spotify:playlist:37i9dQZF1E4YuevTvB5WHT",
          "spotify:user:spotify:playlist:37i9dQZF1DXdxZQJxjFMLO",
          "spotify:user:126202651:playlist:65fTj3YJl4jvFmXxru7BfO",
          "spotify:user:126202651:playlist:4jmwGUvZ8XI9DmWa3NthVq",
          "spotify:user:126202651:playlist:5wO8RqOaWT9PDJNMnktftP",
          "spotify:user:126202651:playlist:3D3gu4wURrZfR813RTh5M8",
          "spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu",
          "spotify:playlist:37i9dQZEVXcMDffrPenJPl",
          "spotify:user:spotify:playlist:37i9dQZF1DX0YKekzl0blG",
          "spotify:user:spotify:playlist:37i9dQZF1E4lDVOWeZX2IT",
          "spotify:user:spotify:playlist:37i9dQZF1E4pBKIU2s8AX1",
          "spotify:user:spotify:playlist:37i9dQZF1E4AQ4IdimJyYD",
          "spotify:user:spotify:playlist:37i9dQZF1E4Cpj7tK5yC6M",
          "spotify:user:spotify:playlist:37i9dQZF1E4tcQYL2Wtnge",
          "spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY",
          "spotify:playlist:37i9dQZF1E8DMpUzqgcOJh",
          "spotify:playlist:3dj3AYHFe2RKKjdQsaOWYl",
          "spotify:playlist:37i9dQZF1DX0GDEVNHvE3h",
          "spotify:playlist:37i9dQZF1DXaMu9xyX1HzK",
          "spotify:playlist:37i9dQZF1EtiMc33WI4nNn",
          "spotify:playlist:37i9dQZF1E354DBk6AJ16Y",
          "spotify:playlist:37i9dQZF1E38mQjeIPb1EL",
          "spotify:playlist:37i9dQZF1E37INBdbw9l8Q",
          "spotify:playlist:37i9dQZF1E38XO0gwAEnvS",
          "spotify:playlist:37i9dQZF1E37RF0IYL80qo",
          "spotify:playlist:37i9dQZF1E38hC1b4cOQvA",
          "spotify:playlist:37i9dQZF1CAqqQ5eUaE9tb",
          "spotify:playlist:4gmNQHup10wDckuwWL3IFZ"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - delay:
          seconds: 90
      - service: media_player.select_source
        data:
          entity_id: media_player.spotify
          source: "Everywhere"
      - delay:
          seconds: 2
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify
      - delay:
          seconds: 2
      - service: media_player.shuffle_set
        data:
          entity_id: media_player.spotify
        data_template:
          shuffle: >-
            {%- set shuffle = [true, false] -%}
            {% set sindex =  (range(0, (shuffle | length - 1 ) )|random) -%}
            {{ shuffle[sindex] }}
      - delay:
          seconds: 2
      - service: media_player.volume_set
        data:
          entity_id: media_player.spotify
          volume_level: 0.30
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Lowfi
          message: "Playing Arrival playlist: {{ playlist }}"
      - alias: "Play arrival music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  spotify_bedtime:
    alias: "Spotify Bedtime"
    variables:
      playlist: >-
        {# 
        ## Arctic Monkeys - AM : spotify:album:78bpIziExqiI9qztvNFlQu 
        ## All Out 90s : spotify:playlist:37i9dQZF1DXbTxeAdrVG2l
        ## 2000s Smash Hits : spotify:playlist:2f6tXtN0XesjONxicAzMIw
        ## 2019 Sealand Invitiational : spotify:playlist:6uNCXLheVaTbfE1HRCIsQ5
        ## Discover Weekly: spotify:playlist:37i9dQZEVXcMDffrPenJPl
        ## 90s Acoustic: spotify:user:spotify:playlist:37i9dQZF1DXb9LIXaj5WhL
        ## This is Passion Pit: spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu
        ## Panic! at the Disco Pretty. Odd. : spotify:album:7Hk9WbjPbN1n2GXaK7aldw
        ## This is The Mountain Goats : spotify:playlist:37i9dQZF1DWTmUQ5ZV8Wa1
        ## It's ALT Good! : spotify:user:spotify:playlist:37i9dQZF1DX2SK4ytI2KAZ
        ## The Griswolds : spotify:playlist:37i9dQZF1DZ06evO1XPrLQ
        ## The Wombats : spotify:artist:0Ya43ZKWHTKkAbkoJJkwIB
        ## The Decemberists @ Palace 2018 : spotify:user:126202651:playlist:4CIBhwpAL598munofpCu6i
        ## This is Jimmy Eat World : spotify:user:spotify:playlist:37i9dQZF1DX4wNVWmoZ4FM
        ## David Bowie Legacy : spotify:album:4JEgSaokMH5mMRClx9wp3S
        ## This is Cake: spotify:user:spotify:playlist:37i9dQZF1DZ06evO3T3SWA
        ## SDSU : spotify:user:126202651:playlist:56WlVUutx91MElxdsbtzj1
        ## Your Top Songs 2018 : spotify:user:spotify:playlist:37i9dQZF1Ejutsu6U8IhOf
        ## Your Top Songs 2017 : spotify:user:spotify:playlist:37i9dQZF1E9G2yMdYA64HW
        ## Your Time Capsule : spotify:user:spotify:playlist:37i9dQZF1E4YuevTvB5WHT
        ## This is The Lumineers : spotify:user:spotify:playlist:37i9dQZF1DXdxZQJxjFMLO
        ## Guster @ Showbox Seattle 2/16/2019 spotify:user:126202651:playlist:65fTj3YJl4jvFmXxru7BfO
        ## Guster @ First Ave MSP 2/9/2019 spotify:user:126202651:playlist:4jmwGUvZ8XI9DmWa3NthVq
        ## Coheed & Cambria @ The Armory MSP 7/26/2018 spotify:user:126202651:playlist:5wO8RqOaWT9PDJNMnktftP
        ## Jimmy Eat World @ First Ave Minneapolis 5/9/18 spotify:user:126202651:playlist:3D3gu4wURrZfR813RTh5M8
        ## This is Passion Pit : spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu
        ## Your Discovery Weekly : spotify:playlist:37i9dQZEVXcMDffrPenJPl
        ## Alternative 00s : spotify:user:spotify:playlist:37i9dQZF1DX0YKekzl0blG
        ## Panic at the Disco Radio : spotify:user:spotify:playlist:37i9dQZF1E4lDVOWeZX2IT
        ## Decemberists Radio : spotify:user:spotify:playlist:37i9dQZF1E4pBKIU2s8AX1
        ## Guster Radio : spotify:user:spotify:playlist:37i9dQZF1E4AQ4IdimJyYD
        ## Jimmy Eat World Radio : spotify:user:spotify:playlist:37i9dQZF1E4tDgdv9Es4ng
        ## The Lumineers Radio : spotify:user:spotify:playlist:37i9dQZF1E4Cpj7tK5yC6M
        ## Band of Hourses Radio : spotify:user:spotify:playlist:37i9dQZF1E4tcQYL2Wtnge
        ## This is Band of Horses : spotify:user:spotify:playlist:37i9dQZF1DZ06evO0pK2Aw
        ## Henry Jamison Radio : spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY
        ## Happier Radio : spotify:playlist:37i9dQZF1E8DMpUzqgcOJh
        ## Guster @ Weesner Family Ampitheater (MN Zoo), Jul 22, 2019
        ## This is Tool : spotify:playlist:37i9dQZF1DX0GDEVNHvE3h
        ## Best of the Decade 2011-2019: spotify:playlist:37i9dQZF1DXaMu9xyX1HzK
        ## Top Songs of 2019: spotify:playlist:37i9dQZF1EtiMc33WI4nNn
        ## Daily Mix 1: spotify:playlist:37i9dQZF1E37INBdbw9l8Q
        ## Daily Mix 2: spotify:playlist:37i9dQZF1E38mQjeIPb1EL
        ## Daily Mix 3: spotify:playlist:37i9dQZF1E354DBk6AJ16Y
        ## Daily Mix 4: spotify:playlist:37i9dQZF1E38XO0gwAEnvS
        ## Daily Mix 5: spotify:playlist:37i9dQZF1E37RF0IYL80qo
        ## Daily Mix 6: spotify:playlist:37i9dQZF1E38hC1b4cOQvA
        ## Summer Rewind: spotify:playlist:37i9dQZF1CAqqQ5eUaE9tb
        ## 90s Pop Rock Essentials: spotify:playlist:37i9dQZF1DX3YMp9n8fkNx
        ## Lo-Fi Beats: spotify:playlist:37i9dQZF1DWWQRwui0ExPn
        ## RetroWave Outrun: spotify:playlist:37i9dQZF1DXdLEN7aqioXM
        ## Simpsons Wave: spotify:playlist:0OZV1MvJmJdeShboKpNKC8
        ## Guster w/Utah Symphone 7/29/22: spotify:playlist:4gmNQHup10wDckuwWL3IFZ
        ## Sigur Ros @ State Theatre 5/31/2022: spotify:playlist:6NiKjgceymmq3yVzxgb9Uv
        ## Pachuca Sunrise Radio: spotify:playlist:37i9dQZF1E8T1k2ZTHYNkV
        #}
        {%- set plists = ["spotify:album:78bpIziExqiI9qztvNFlQu", 
          "spotify:user:spotify:playlist:37i9dQZF1DXbTxeAdrVG2l",
          "spotify:user:myplay.com:playlist:2f6tXtN0XesjONxicAzMIw",
          "spotify:user:126202651:playlist:6uNCXLheVaTbfE1HRCIsQ5",
          "spotify:playlist:37i9dQZEVXcMDffrPenJPl",
          "spotify:user:spotify:playlist:37i9dQZF1DXb9LIXaj5WhL",
          "spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu",
          "spotify:album:7Hk9WbjPbN1n2GXaK7aldw",
          "spotify:playlist:37i9dQZF1DWTmUQ5ZV8Wa1",
          "spotify:user:spotify:playlist:37i9dQZF1DX2SK4ytI2KAZ",
          "spspotify:playlist:37i9dQZF1DZ06evO1XPrLQ",
          "spotify:artist:0Ya43ZKWHTKkAbkoJJkwIB",
          "spotify:user:126202651:playlist:4CIBhwpAL598munofpCu6i",
          "spotify:user:spotify:playlist:37i9dQZF1DX4wNVWmoZ4FM",
          "spotify:album:4JEgSaokMH5mMRClx9wp3S",
          "spotify:user:126202651:playlist:56WlVUutx91MElxdsbtzj1",
          "spotify:user:spotify:playlist:37i9dQZF1Ejutsu6U8IhOf",
          "spotify:user:spotify:playlist:37i9dQZF1E9G2yMdYA64HW",
          "spotify:user:spotify:playlist:37i9dQZF1E4YuevTvB5WHT",
          "spotify:user:spotify:playlist:37i9dQZF1DXdxZQJxjFMLO",
          "spotify:user:126202651:playlist:65fTj3YJl4jvFmXxru7BfO",
          "spotify:user:126202651:playlist:4jmwGUvZ8XI9DmWa3NthVq",
          "spotify:user:126202651:playlist:5wO8RqOaWT9PDJNMnktftP",
          "spotify:user:126202651:playlist:3D3gu4wURrZfR813RTh5M8",
          "spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu",
          "spotify:playlist:37i9dQZEVXcMDffrPenJPl",
          "spotify:user:spotify:playlist:37i9dQZF1DX0YKekzl0blG",
          "spotify:user:spotify:playlist:37i9dQZF1E4lDVOWeZX2IT",
          "spotify:user:spotify:playlist:37i9dQZF1E4pBKIU2s8AX1",
          "spotify:user:spotify:playlist:37i9dQZF1E4AQ4IdimJyYD",
          "spotify:user:spotify:playlist:37i9dQZF1E4Cpj7tK5yC6M",
          "spotify:user:spotify:playlist:37i9dQZF1E4tcQYL2Wtnge",
          "spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY",
          "spotify:playlist:37i9dQZF1E8DMpUzqgcOJh",
          "spotify:playlist:3dj3AYHFe2RKKjdQsaOWYl",
          "spotify:playlist:37i9dQZF1DX0GDEVNHvE3h",
          "spotify:playlist:37i9dQZF1DXaMu9xyX1HzK",
          "spotify:playlist:37i9dQZF1EtiMc33WI4nNn",
          "spotify:playlist:37i9dQZF1E354DBk6AJ16Y",
          "spotify:playlist:37i9dQZF1E38mQjeIPb1EL",
          "spotify:playlist:37i9dQZF1E37INBdbw9l8Q",
          "spotify:playlist:37i9dQZF1E38XO0gwAEnvS",
          "spotify:playlist:37i9dQZF1E37RF0IYL80qo",
          "spotify:playlist:37i9dQZF1E38hC1b4cOQvA",
          "spotify:playlist:37i9dQZF1CAqqQ5eUaE9tb",
          "spotify:playlist:37i9dQZF1DX3YMp9n8fkNx",
          "spotify:playlist:37i9dQZF1DWWQRwui0ExPn",
          "spotify:playlist:37i9dQZF1DXdLEN7aqioXM",
          "spotify:playlist:0OZV1MvJmJdeShboKpNKC8",
          "spotify:playlist:4gmNQHup10wDckuwWL3IFZ",
          "spotify:playlist:6NiKjgceymmq3yVzxgb9Uv",
          "spotify:playlist:37i9dQZF1E8T1k2ZTHYNkV"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      # - service: media_player.join
      #   target:
      #     entity_id:
      #       - media_player.bedroom
      #   data:
      #     group_members:
      #       - media_player.bathroom
      #       - media_player.office
      #       - media_player.den_1
      - if:
          - alias: "Check if guests are here."
            condition: state
            entity_id: input_boolean.guest_mode
            state: "off"
        then:
          - alias: "Join Sonos speakers into all group"
            service: media_player.join
            target:
              entity_id:
                - media_player.bedroom
            data:
              group_members:
                - media_player.bathroom
                - media_player.den_1
                - media_player.office
        else:
          - alias: "Join Sonos speakers into all bedroom group"
            service: media_player.join
            target:
              entity_id:
                - media_player.bedroom
            data:
              group_members:
                - media_player.bathroom
      - service: media_player.shuffle_set
        data:
          entity_id: media_player.bedroom
        data_template:
          shuffle: >-
            {%- set shuffle = [true, false] -%}
            {% set sindex =  (range(0, (shuffle | length - 1 ) )|random) -%}
            {{ shuffle[sindex] }}
      - service: media_player.repeat_set
        data:
          repeat: all
        target:
          entity_id: media_player.bedroom
      - delay:
          seconds: 2
      - service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
            - media_player.den_1
          volume_level: 0.20
      - delay:
          seconds: 2
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play Bedtime
          message: "Playing Bedtime playlist: {{ playlist }}"
      - alias: "Play bedtime music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"
      - wait_for_trigger:
          - platform: state
            entity_id: binary_sensor.owner_suite_bathroom_room_occupancy
            to: "on"
        timeout:
          minutes: 10 # TODO this as a variable that is passed by the caller. Different timeouts for tv off and for laying in bed automation
        continue_on_timeout: false
      - delay:
          minutes: 3
      - service: script.turn_on
        entity_id: script.spotify_bedtime_volume

  spotify_bedtime_volume:
    alias: "Spotify Bedtime Rampdown"
    sequence:
      - service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.office
            - media_player.bathroom
            - media_player.den_1
          volume_level: 0.15
      - delay:
          minutes: 2
      - service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
          volume_level: 0.1
      - delay:
          minutes: 2
      - service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
          volume_level: 0.05
      - delay:
          minutes: 2
      - service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
          volume_level: 0.01

  spotify_wake_up:
    alias: "Spotify Wake Up"
    icon: mdi:weather-sunset-up
    description: "Play music in the morning when I visit the bathroom."
    variables:
      playlist: >-
        {#
        ## Your Top Songs 2017 : spotify:user:spotify:playlist:37i9dQZF1E9G2yMdYA64HW
        ## Have a Great Day! : spotify:user:spotify:playlist:37i9dQZF1DX7KNKjOK0o75
        ## 90s Greatest Guilty Pleasures: spotify:user:patreeeek:playlist:05TbIsuVoDIQI1nfVwhpTs
        ## Alternative Nation: spotify:user:topsify:playlist:1uBI8icgYcUED3T1W1X6dB
        ## Matt & Kim Daylight Playlist: spotify:user:127725734:playlist:1tpH6e8WmMkWZNKv9HFvGK
        ## MGMT Kids Playlist: spotify:user:gorillagoat:playlist:7aX5kvEDdre0kHNCvQ9sbr
        ## Guardians of the Galaxy Vols 1 & 2 : spotify:user:hollywdrecrds:playlist:1xY6msLHX1W34EzB0UkkbU
        ## Walk the Moon Talking is Hard: spotify:album:3mNoFlD1wsoXfkljfFzExT
        ## This is Fall Out Boy: spotify:user:spotify:playlist:37i9dQZF1DX4JbuQ72y8Ek
        ## This is Panic! at the Disco : spotify:user:spotify:playlist:37i9dQZF1DX5C8bjZ5YDv7
        ## Coheed & Cambria Good Apollo: spotify:track:4Dc5crLrKYIIqf6sk0PvQm
        ## APC Mer De Noms: spotify:album:0GeWd0yUKXHbCXVag1mJvO
        ## Matt and Kim : Lightning : spotify:album:2MbpbHn31Luzr8G3uDsSUH
        ## '90s Pop Rock Essentials : spotify:user:spotify:playlist:37i9dQZF1DX3YMp9n8fkNx
        ## 90s Rock Anthems: spotify:user:spotify:playlist:37i9dQZF1DX1rVvRgjX59F
        ## Your Top Songs 2018 : spotify:user:spotify:playlist:37i9dQZF1Ejutsu6U8IhOf
        ## Your Time Capsule : spotify:user:spotify:playlist:37i9dQZF1E4YuevTvB5WHT
        ## This is The Lumineers : spotify:user:spotify:playlist:37i9dQZF1DXdxZQJxjFMLO
        ## Guster @ Showbox Seattle 2/16/2019 spotify:user:126202651:playlist:65fTj3YJl4jvFmXxru7BfO
        ## Guster @ First Ave MSP 2/9/2019 spotify:user:126202651:playlist:4jmwGUvZ8XI9DmWa3NthVq
        ## Coheed & Cambria @ The Armory MSP 7/26/2018 spotify:user:126202651:playlist:5wO8RqOaWT9PDJNMnktftP
        ## Jimmy Eat World @ First Ave Minneapolis 5/9/18 spotify:user:126202651:playlist:3D3gu4wURrZfR813RTh5M8
        ## This is Passion Pit : spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu
        ## Your Discovery Weekly : spotify:playlist:37i9dQZEVXcMDffrPenJPl
        ## Alternative 00s : spotify:user:spotify:playlist:37i9dQZF1DX0YKekzl0blG
        ## Panic at the Disco Radio : spotify:user:spotify:playlist:37i9dQZF1E4lDVOWeZX2IT
        ## Decemberists Radio : spotify:user:spotify:playlist:37i9dQZF1E4pBKIU2s8AX1
        ## Guster Radio : spotify:user:spotify:playlist:37i9dQZF1E4AQ4IdimJyYD
        ## Jimmy Eat World Radio : spotify:user:spotify:playlist:37i9dQZF1E4tDgdv9Es4ng
        ## The Lumineers Radio : spotify:user:spotify:playlist:37i9dQZF1E4Cpj7tK5yC6M
        ## Band of Hourses Radio : spotify:user:spotify:playlist:37i9dQZF1E4tcQYL2Wtnge
        ## This is Band of Horses : spotify:user:spotify:playlist:37i9dQZF1DZ06evO0pK2Aw
        ## Henry Jamison Radio : spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY
        ## Happier Radio : spotify:playlist:37i9dQZF1E8DMpUzqgcOJh
        ## Guster @ Weesner Family Ampitheater (MN Zoo), Jul 22, 2019
        ## This is Tool : spotify:playlist:37i9dQZF1DX0GDEVNHvE3h
        ## Best of the Decade 2011-2019: spotify:playlist:37i9dQZF1DXaMu9xyX1HzK
        ## Top Songs of 2019: spotify:playlist:37i9dQZF1EtiMc33WI4nNn
        ## Daily Mix 1: spotify:playlist:37i9dQZF1E37INBdbw9l8Q
        ## Daily Mix 2: spotify:playlist:37i9dQZF1E38mQjeIPb1EL
        ## Daily Mix 3: spotify:playlist:37i9dQZF1E354DBk6AJ16Y
        ## Daily Mix 4: spotify:playlist:37i9dQZF1E38XO0gwAEnvS
        ## Daily Mix 5: spotify:playlist:37i9dQZF1E37RF0IYL80qo
        ## Daily Mix 6: spotify:playlist:37i9dQZF1E38hC1b4cOQvA
        ## Summer Rewind: spotify:playlist:37i9dQZF1CAqqQ5eUaE9tb
        ## Guster w/Utah Symphony 7/29/22: spotify:playlist:4gmNQHup10wDckuwWL3IFZ
        ## Sigur Ros @ State Theatre: spotify:playlist:6NiKjgceymmq3yVzxgb9Uv
        ## City Pop: spotify:playlist:7kyjn0z8NNlEYJ8ZAwEYkk
        ## Pachuca Sunrise Radio: spotify:playlist:37i9dQZF1E8T1k2ZTHYNkV
        #}
        {%- set plists = ["spotify:user:spotify:playlist:37i9dQZF1E9G2yMdYA64HW", 
          "spotify:user:myplay.com:playlist:3hoI0s5TLdpPMcimSRmQpj",
          "spotify:user:patreeeek:playlist:05TbIsuVoDIQI1nfVwhpTs",
          "spotify:user:topsify:playlist:1uBI8icgYcUED3T1W1X6dB",
          "spotify:user:127725734:playlist:1tpH6e8WmMkWZNKv9HFvGK",
          "spotify:user:gorillagoat:playlist:7aX5kvEDdre0kHNCvQ9sbr",
          "spotify:user:hollywdrecrds:playlist:1xY6msLHX1W34EzB0UkkbU",
          "spotify:album:3mNoFlD1wsoXfkljfFzExT",
          "spotify:user:spotify:playlist:37i9dQZF1DX4JbuQ72y8Ek",
          "spotify:user:spotify:playlist:37i9dQZF1DX5C8bjZ5YDv7",
          "spotify:track:4Dc5crLrKYIIqf6sk0PvQm",
          "spotify:album:0GeWd0yUKXHbCXVag1mJvO",
          "spotify:album:2MbpbHn31Luzr8G3uDsSUH",
          "spotify:user:spotify:playlist:37i9dQZF1DX3YMp9n8fkNx",
          "spotify:user:spotify:playlist:37i9dQZF1DX1rVvRgjX59F",
          "spotify:user:spotify:playlist:37i9dQZF1Ejutsu6U8IhOf",
          "spotify:user:spotify:playlist:37i9dQZF1E4YuevTvB5WHT",
          "spotify:user:spotify:playlist:37i9dQZF1DXdxZQJxjFMLO",
          "spotify:user:126202651:playlist:65fTj3YJl4jvFmXxru7BfO",
          "spotify:user:126202651:playlist:4jmwGUvZ8XI9DmWa3NthVq",
          "spotify:user:126202651:playlist:5wO8RqOaWT9PDJNMnktftP",
          "spotify:user:126202651:playlist:3D3gu4wURrZfR813RTh5M8",
          "spotify:user:spotify:playlist:37i9dQZF1DZ06evO4iu5hu",
          "spotify:playlist:37i9dQZEVXcMDffrPenJPl",
          "spotify:user:spotify:playlist:37i9dQZF1DX0YKekzl0blG",
          "spotify:user:spotify:playlist:37i9dQZF1E4lDVOWeZX2IT",
          "spotify:user:spotify:playlist:37i9dQZF1E4pBKIU2s8AX1",
          "spotify:user:spotify:playlist:37i9dQZF1E4AQ4IdimJyYD",
          "spotify:user:spotify:playlist:37i9dQZF1E4Cpj7tK5yC6M",
          "spotify:user:spotify:playlist:37i9dQZF1E4tcQYL2Wtnge",
          "spotify:user:spotify:playlist:37i9dQZF1E4xIBgPnPOnGY",
          "spotify:playlist:37i9dQZF1E8DMpUzqgcOJh",
          "spotify:playlist:3dj3AYHFe2RKKjdQsaOWYl",
          "spotify:playlist:37i9dQZF1DX0GDEVNHvE3h",
          "spotify:playlist:37i9dQZF1DXaMu9xyX1HzK",
          "spotify:playlist:37i9dQZF1EtiMc33WI4nNn",
          "spotify:playlist:37i9dQZF1E354DBk6AJ16Y",
          "spotify:playlist:37i9dQZF1E38mQjeIPb1EL",
          "spotify:playlist:37i9dQZF1E37INBdbw9l8Q",
          "spotify:playlist:37i9dQZF1E38XO0gwAEnvS",
          "spotify:playlist:37i9dQZF1E37RF0IYL80qo",
          "spotify:playlist:37i9dQZF1E38hC1b4cOQvA",
          "spotify:playlist:37i9dQZF1CAqqQ5eUaE9tb",
          "spotify:playlist:4gmNQHup10wDckuwWL3IFZ",
          "spotify:playlist:6NiKjgceymmq3yVzxgb9Uv",
          "spotify:playlist:7kyjn0z8NNlEYJ8ZAwEYkk",
          "spotify:playlist:37i9dQZF1E8T1k2ZTHYNkV"
          ] -%}
          {% set pindex =  (range(0, (plists | length - 1 ) )|random) -%}
          {{ plists[pindex] }}
    sequence:
      - if:
          - alias: "Check if guests are here."
            condition: state
            entity_id: input_boolean.guest_mode
            state: "off"
        then:
          - alias: "No Guests: Join Sonos speakers into all group"
            service: media_player.join
            target:
              entity_id:
                - media_player.bedroom
            data:
              group_members:
                - media_player.bathroom
                - media_player.den_1
                - media_player.office
        else:
          - alias: "Guests here: Unjoin all Sonos speakers into bedroom group"
            service: media_player.unjoin
            target:
              entity_id:
                - media_player.bedroom
                - media_player.bathroom
                - media_player.den_1
                - media_player.office
          - alias: "Guests here: Join Sonos speakers into bedroom group"
            service: media_player.join
            target:
              entity_id:
                - media_player.bedroom
            data:
              group_members:
                - media_player.bathroom
      - delay:
          seconds: 2
      - alias: "Pause currently playing media"
        service: media_player.media_pause
        data:
          entity_id: media_player.bedroom
      - delay:
          seconds: 2
      - alias: "Enable Shuffle"
        service: media_player.shuffle_set
        data:
          entity_id: media_player.bedroom
        data_template:
          shuffle: >-
            {%- set shuffle = [true, false] -%}
            {% set sindex =  (range(0, (shuffle | length - 1 ) )|random) -%}
            {{ shuffle[sindex] }}
      - service: media_player.repeat_set
        data:
          repeat: all
        target:
          entity_id: media_player.bedroom
      - delay:
          seconds: 2
      - alias: "Set volume low"
        service: media_player.volume_set
        data:
          entity_id:
            - media_player.bedroom
            - media_player.bathroom
            - media_player.office
          volume_level: 0.01
      - delay:
          seconds: 2
      - service: logbook.log
        data_template:
          entity_id: media_player.bedroom
          name: Play morning playlist
          message: "Playing wakup playlist: {{ playlist }}"
      - alias: "Play random wakeup music"
        service: media_player.play_media
        data:
          entity_id: media_player.bedroom
          media_content_type: playlist
        data_template:
          media_content_id: "{{ playlist }}"

  watch_tv:
    alias: "Watch TV"
    sequence:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi
      - service: media_player.turn_on
        data:
          entity_id: media_player.basement
      - service: media_player.turn_on
        data:
          entity_id: media_player.lg_webos_smart_tv
      - wait_template: "{{is_state(' media_player.lg_webos_smart_tv','on')}}"
      - service: media_player.select_source
        data:
          entity_id: media_player.lg_webos_smart_tv
          source: "HDMI 1"
      - service: media_player.select_source
        data:
          entity_id: media_player.basement
          source: "YouTube TV"

  watch_hbo_now:
    alias: "Watch HBO"
    sequence:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi
      - service: media_player.turn_on
        data:
          entity_id: media_player.living_room_firetv
      - wait_template: "{{ is_state('media_player.living_room_firetv','off') != True }}"
      - service: media_player.turn_on
        data:
          entity_id: media_player.lg_webos_smart_tv
      - wait_template: "{{is_state(' media_player.lg_webos_smart_tv','on')}}"
      - service: media_player.select_source
        data:
          entity_id: media_player.lg_webos_smart_tv
          source: "HDMI 1"
      - service: media_player.select_source
        data:
          entity_id: media_player.living_room_firetv
          source: "com.hbo.hbonow"

  watch_netflix:
    alias: "Watch Netflix"
    sequence:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi
      - service: media_player.turn_on
        data:
          entity_id: media_player.living_room_firetv
      - wait_template: "{{ is_state('media_player.living_room_firetv','off') != True }}"
      - service: media_player.turn_on
        data:
          entity_id: media_player.lg_webos_smart_tv
      - wait_template: "{{is_state(' media_player.lg_webos_smart_tv','on')}}"
      - service: media_player.select_source
        data:
          entity_id: media_player.lg_webos_smart_tv
          source: "HDMI 1"
      - service: media_player.select_source
        data:
          entity_id: media_player.living_room_firetv
          source: "Netflix"
      - service: media_player.select_source
        data:
          entity_id: media_player.spotify
          source: "Everywhere"
      - delay:
          seconds: 2
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify

  watch_plex:
    alias: "Watch Plex"
    sequence:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi
      - service: media_player.turn_on
        data:
          entity_id: media_player.living_room_firetv
      - wait_template: "{{ is_state('media_player.living_room_firetv','off') != True }}"
      - service: media_player.turn_on
        data:
          entity_id: media_player.lg_webos_smart_tv
      - wait_template: "{{is_state(' media_player.lg_webos_smart_tv','on')}}"
      - service: media_player.select_source
        data:
          entity_id: media_player.lg_webos_smart_tv
          source: "HDMI 1"
      - service: media_player.select_source
        data:
          entity_id: media_player.living_room_firetv
          source: "Plex"
      - service: media_player.select_source
        data:
          entity_id: media_player.spotify
          source: "Everywhere"
      - delay:
          seconds: 2
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify

  watch_letterkenny:
    alias: "Watch Letterkenny"
    sequence:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi
      - service: media_player.turn_on
        data:
          entity_id: media_player.living_room_firetv
      - wait_template: "{{ is_state('media_player.living_room_firetv','off') != True }}"
      - service: media_player.turn_on
        data:
          entity_id: media_player.lg_webos_smart_tv
      - wait_template: "{{is_state(' media_player.lg_webos_smart_tv','on')}}"
      - service: media_player.select_source
        data:
          entity_id: media_player.lg_webos_smart_tv
          source: "HDMI 1"
      - service: media_player.select_source
        data:
          entity_id: media_player.living_room_firetv
          source: "com.plexapp.android"
      - service: media_player.select_source
        data:
          entity_id: media_player.spotify
          source: "Everywhere"
      - delay:
          seconds: 2
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify

  watch_popcorn_time:
    alias: "Watch Popcorn Time"
    sequence:
      - service: switch.turn_on
        entity_id: switch.4k_hdmi
      - service: media_player.turn_on
        data:
          entity_id: media_player.living_room_firetv
      - wait_template: "{{ is_state('media_player.living_room_firetv','off') != True }}"
      - service: media_player.turn_on
        data:
          entity_id: media_player.lg_webos_smart_tv
      - wait_template: "{{is_state(' media_player.lg_webos_smart_tv','on')}}"
      - service: media_player.select_source
        data:
          entity_id: media_player.lg_webos_smart_tv
          source: "HDMI 1"
      - service: media_player.select_source
        data:
          entity_id: media_player.living_room_firetv
          source: "pct.droid.tv"
      - service: media_player.select_source
        data:
          entity_id: media_player.spotify
          source: "Everywhere"
      - delay:
          seconds: 2
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify

########################
# Sensor
########################
sensor:

########################
# Switch
########################
switch:

########################
# webosTV
########################
# YAML Deprecated 2022.2
# webostv:
#   - host: !secret lg_tv_ip

########################
# Zone
########################
zone:
