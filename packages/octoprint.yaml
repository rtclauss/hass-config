################################################################
## Packages / OctoPrint
################################################################

################################################
## Customize
################################################

homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: "octoprint"

      expose: &expose
        <<: *customize
        haaska_hidden: false
        homebridge_hidden: false

    ################################################
    ## Alarm Panels
    ################################################

    ################################################
    ## Automations
    ################################################

    ################################################
    ## Binary Sensors
    ################################################

    ################################################
    ## Cameras
    ################################################

    ################################################
    ## Climate
    ################################################

    ################################################
    ## Covers
    ################################################

    ################################################
    ## Device Trackers
    ################################################

    ################################################
    ## Fans
    ############

    ################################################
    ## Frontend
    ################################################

    ################################################
    ## Groups
    ################################################

    ################################################
    ## Input Boolean
    ################################################

    ################################################
    ## Input Numbers
    ################################################

    ################################################
    ## Input Select
    ################################################

    ################################################
    ## iOS
    ################################################

    ################################################
    ## Light
    ################################################

    ################################################
    ## Media Player
    ################################################

    ################################################
    ##  Notify
    ################################################

    ################################################
    ## Plant
    ################################################

    ################################################
    ## Proximity
    ################################################

    ################################################
    ## Scripts
    ################################################

    ################################################
    ## Sensors
    ################################################

    ################################################
    ## Switches
    ################################################

    ################################################
    ## Thermostats
    ################################################

    ################################################
    ## Weather
    ################################################

    ################################################
    ## Zone
    ################################################

########################
# Alarm Panel
########################
alarm_control_panel: []

########################
## Automation
########################
automation:
  - id: notify_3d_print_finished
    alias: notify_3d_print_finished
    trigger:
      - trigger: state
        entity_id: binary_sensor.octoprint_printing
        from: "on"
        to: "off"
        for:
          minutes: 30
    action:
      - action: notify.all
        data:
          message: 3D print finished!

########################
# Binary Sensors
########################
binary_sensor: []
  # - platform: octoprint
  #   monitored_conditions:
  #     - Printing
  #     - Printing Error

########################
# Cameras
########################
camera: []
  # - platform: mjpeg
  #   name: OctoPrint
  #   still_image_url: !secret octopi_still_image_url
  #   mjpeg_url: !secret octopi_mjpeg_url

########################
# Climate
########################
climate: []

########################
# Covers
########################
cover: []

########################
# Device Trackers
########################
device_tracker: []

########################
# Fans
########################
fan: []

########################
# Frontend
########################
frontend: []

########################
# Groups
########################
group: []

########################
# Input Booleans
########################
input_boolean: []

########################
# Input DateTime
########################
input_datetime: []

########################
# Input Numbers
########################
input_number: []

########################
# Input Select
########################
input_select: []

########################
# iOS
########################
ios: []

########################
# Light
########################
light: []

########################
# Media Player
########################
media_player: []

########################
# Notify
########################
notify: []

########################
# Octoprint
########################
# 11/3/2021 configuration moved to UI
# octoprint:
#   host: !secret octoprint_host
#   api_key: !secret octoprint_api_key
#   bed: true
#   number_of_tools: 1

########################
# Plant
########################
plant:

########################
# Scenes
########################
scene: []

########################
# Scripts
########################
script: []

########################
# Sensor
########################
sensor: []

########################
# Switch
########################
switch: []

########################
# Template
########################
template:
  - sensor:
      - name: "OctoPrint Time Elapsed"
        unit_of_measurement: "s"
        availability: >
          {{ not is_state('sensor.octoprint_start_time', 'unavailable') }}
        state: >
          {% set start = as_timestamp(states('sensor.octoprint_start_time')) %}
          {% if is_number(start) %}
            {{ (as_timestamp(now()) - start) | int }}
          {% else %}
            unknown
          {% endif %}
        attributes:
          start_time: "states('sensor.octoprint_start_time')"
      - name: "OctoPrint Time Remaining"
        unit_of_measurement: "s"
        availability: >
          {{ not is_state('sensor.octoprint_estimated_finish_time', 'unavailable') }}
        state: >
          {% set finish = as_timestamp(states('sensor.octoprint_estimated_finish_time')) %}
          {% if is_number(finish) %}
            {{ (finish - as_timestamp(now())) | int }}
          {% else %}
            unknown
          {% endif %}
        attributes:
          start_time: "states('sensor.octoprint_estimated_finish_time')"

########################
# Weather
########################
weather: []

########################
# Zone
########################
zone: []
